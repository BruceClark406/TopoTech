{% extends "./layout.html" %}

{% block content %}

        <script src="{{ url_for('static', filename='js/threeMin.js') }}"></script>
        <!--<script src="{{ url_for('static', filename='js/three.OBJLoader.js') }}"></script>-->
        <script src="{{ url_for('static', filename='js/three.OrbitControls.js') }}"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>  
        <script src="{{ url_for('static', filename='js/main.js') }}"></script> 

        <div id="object_viewer_div" style="width: 80%;">    
        </div>

        <script>
            var this_nav = document.querySelectorAll("a[href='./object_viewer']");
			this_nav[0].parentElement.classList.add('active');

            var section = document.getElementsByClassName('container-fluid')[0];
            
            let elevations

            //gets coordinates and then returns elevations
            $.ajax({
                url: "get_coordinates",
                type: "GET",
                async: false,
                success: function(response){
                    elevations = stringToArray(response);
                },
                error: function(error){
                    console.log(error);
                }
            })
            
            //get rid of parentheses sourounding shape
            let width = elevations[elevations.length-1]
            width = parseInt(width.replace(")", ""))
            let height = elevations[elevations.length-2]
            height = parseInt(height.replace("(", ""))

            elevations.pop()
            elevations.pop()
            
            //get rid of brackets sourounding shape
            elevations[0] = elevations[0].replace("[", "")
            elevations[elevations.length-1] = elevations[elevations.length-1].replace("]", "")

            //convert to typeof number
            elevations = stringToNumArray(elevations)

            

            //THREE JS IMPLEMENTATION
            let scene = new THREE.Scene();
            let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000)
            camera.position.z = 5;

            let renderer = new THREE.WebGLRenderer();
            renderer.setClearColor("#e5e5e5");
            renderer.setSize(window.innerWidth,window.innerHeight);

            //where to render
            let object_viewer_div = document.getElementById("object_viewer_div");
            object_viewer_div.appendChild(renderer.domElement); //MGIHT NEED TO GO FARTHER DOWN

            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth,window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            })

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0, 0);
            controls.update();
            
            //create the plane -> width, height, width-verticies, height-verticies
            let geometry = new THREE.PlaneGeometry(width/260, height/260, width-1, height-1);
            //let geometry = new THREE.PlaneGeometry(3, 4, width-1, height-1);

            //extrude verticies on the plane
            for (let i = 0, l = geometry.vertices.length; i < l; i++) {
                geometry.vertices[i].z = elevations[i] / 65535 * 10;
            }

            // create meaterial
            let material = new THREE.MeshLambertMaterial({color: 0xFFCC00, wireframe: true});
            let mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            //change the orientation of the camera
            mesh.lookAt(new THREE.Vector3(0, 1, 0));


            //add light
            let light = new THREE.PointLight(0xFFFFFF,1,500)
            light.position.set(10,0,25);
            scene.add(light);

            //animate for object controls
            function animate() {

                requestAnimationFrame( animate );

                // required if controls.enableDamping or controls.autoRotate are set to true
                controls.update();

                renderer.render( scene, camera );
            }   

            animate()
            
            
        </script>
        

        

{% endblock %}
